å¥½ï¼æˆ‘ä»¬ç›´æ¥ç”¨**å°å†…å­˜å›¾ + ä¾‹å­**æ¥å¯¹æ¯” ğŸ‘‡

---

## 1ï¸âƒ£ String å†…å­˜å›¾ï¼ˆä¸å¯å˜ï¼‰

ç¤ºä¾‹ä»£ç ï¼š

```java
String s = "abc";
s = s + "d";
```

### ç¬¬ä¸€æ­¥ï¼š`String s = "abc";`

```text
ã€æ ˆ Stackã€‘                  ã€å † Heapã€‘

   s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  String å¯¹è±¡ #1
                             â”‚
                             â–¼
                        char[] value = {'a','b','c'}
```

* `s` åœ¨ **æ ˆ** ä¸Šï¼Œæ˜¯ä¸€ä¸ªå¼•ç”¨
* æŒ‡å‘å †é‡Œçš„ä¸€ä¸ª `String` å¯¹è±¡
* `String` é‡Œé¢æœ‰ä¸ª `char[]`ï¼ˆJDK9 ä¹‹åæ˜¯ `byte[]`ï¼Œæ¦‚å¿µä¸€æ ·ï¼‰

---

### ç¬¬äºŒæ­¥ï¼š`s = s + "d";`

`String` æ˜¯ **ä¸å¯å˜çš„ï¼ˆimmutableï¼‰**ï¼Œæ‰€ä»¥ä¸ä¼šä¿®æ”¹åŸæ¥çš„å¯¹è±¡ï¼Œè€Œæ˜¯ï¼š

```text
ã€æ ˆ Stackã€‘                     ã€å † Heapã€‘

   s â”€â”€â”
       â”‚                     String å¯¹è±¡ #1
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶      "abc"
                             
      é‡æ–°èµ‹å€¼åï¼š

   s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  String å¯¹è±¡ #2
                             â”‚
                             â–¼
                        char[] = {'a','b','c','d'}
```

* æ‹¼æ¥ `"d"` æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª**æ–° String å¯¹è±¡**
* `s` è¿™ä¸ªå¼•ç”¨ä»åŸæ¥çš„å¯¹è±¡ #1 å˜æˆæŒ‡å‘å¯¹è±¡ #2
* æ—§å¯¹è±¡ #1 å¦‚æœæ²¡æœ‰å¼•ç”¨æŒ‡å‘ï¼Œå°±äº¤ç»™ GC å›æ”¶

ğŸ‘‰ **æ€»ç»“ï¼š**

* æ¯æ¬¡ `+` æ‹¼æ¥ï¼Œéƒ½ä¼šäº§ç”Ÿ **æ–°å¯¹è±¡**
* å¤šæ¬¡æ‹¼æ¥ = å¤šæ¬¡åˆ›å»ºæ–°å¯¹è±¡ï¼Œæ•ˆç‡å·®

---

## 2ï¸âƒ£ StringBuilder å†…å­˜å›¾ï¼ˆå¯å˜ï¼‰

ç¤ºä¾‹ä»£ç ï¼š

```java
StringBuilder sb = new StringBuilder("abc");
sb.append("d");
```

### ç¬¬ä¸€æ­¥ï¼š`new StringBuilder("abc")`

```text
ã€æ ˆ Stackã€‘                         ã€å † Heapã€‘

   sb â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  StringBuilder å¯¹è±¡
                             â”‚
                             â–¼
                      char[] value = {'a','b','c', ?, ?, ?, ...}
                                   (capacity æ¯” length å¤§)
```

* `sb` åœ¨æ ˆä¸Šï¼Œæ˜¯å¼•ç”¨
* å †é‡Œæ˜¯ä¸€ä¸ª `StringBuilder` å¯¹è±¡
* é‡Œé¢æœ‰ä¸€ä¸ª **å¯å˜çš„ `char[]` ç¼“å†²åŒº**
* å®¹é‡ï¼ˆcapacityï¼‰é€šå¸¸å¤§äºå½“å‰é•¿åº¦ï¼Œä¸ºäº†åé¢ append çœå¾—é¢‘ç¹æ‰©å®¹

---

### ç¬¬äºŒæ­¥ï¼š`sb.append("d");`

**ä¸ä¼šæ–°å»ºå¯¹è±¡ï¼Œåªä¿®æ”¹åŸæ•°ç»„å†…å®¹ï¼š**

```text
ã€æ ˆ Stackã€‘                         ã€å † Heapã€‘

   sb â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  StringBuilder å¯¹è±¡ï¼ˆåŒä¸€ä¸ªï¼‰
                             â”‚
                             â–¼
                      char[] value = {'a','b','c','d', ?, ?, ...}
```

* **åŒä¸€ä¸ª `StringBuilder` å¯¹è±¡**
* åªæ˜¯å¾€é‡Œé¢çš„ `char[]` é‡Œå¤šå†™äº†ä¸€ä¸ª `'d'`
* åªæœ‰å®¹é‡ä¸å¤Ÿæ—¶ï¼Œæ‰ä¼šè§¦å‘ â€œæ‰©å®¹ + æ‹·è´â€

ğŸ‘‰ **æ€»ç»“ï¼š**

* ä¸æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡
* é€‚åˆé¢‘ç¹ã€å¤šæ¬¡æ‹¼æ¥
* æ€§èƒ½æ¯” `String` + æ‹¼æ¥å¥½å¾ˆå¤š

---

## 3ï¸âƒ£ StringBuffer å†…å­˜å›¾ï¼ˆå’Œ StringBuilder å‡ ä¹ä¸€æ ·ï¼Œåªæ˜¯å¤šäº†é”ï¼‰

ç¤ºä¾‹ä»£ç ï¼š

```java
StringBuffer sbf = new StringBuffer("abc");
sbf.append("d");
```

å†…å­˜ç»“æ„å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œåªæ˜¯æ–¹æ³•ä¸Šæœ‰ `synchronized`ï¼š

```text
ã€æ ˆ Stackã€‘                         ã€å † Heapã€‘

  sbf â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  StringBuffer å¯¹è±¡
                            â”‚
                            â–¼
                     char[] value = {'a','b','c','d', ?, ?, ...}
```

* åŒæ ·æ˜¯ **å¯å˜ç¼“å†²åŒº + char[]**
* ä¸åŒç‚¹ï¼š`append` ç­‰æ–¹æ³•æ˜¯ `synchronized`ï¼Œ**çº¿ç¨‹å®‰å…¨ä½†æ›´æ…¢**

---

## 4ï¸âƒ£ ä¸‰è€…å†…å­˜æ¨¡å‹æ€»å¯¹æ¯”

### ğŸ”¹ String

```text
String s = "a";
s = s + "b";
s = s + "c";
```

```text
å †ï¼š
String#1 "a"
String#2 "ab"
String#3 "abc"

æ ˆï¼š
s â†’ String#3
```

* æ¯æ¬¡æ‹¼æ¥éƒ½åˆ›å»ºæ–°å¯¹è±¡
* æ—§çš„å­—ç¬¦ä¸²å¯¹è±¡å¯èƒ½å˜æˆåƒåœ¾ç­‰å¾… GC

---

### ğŸ”¹ StringBuilder

```text
StringBuilder sb = new StringBuilder("a");
sb.append("b");
sb.append("c");
```

```text
å †ï¼š
ä¸€ä¸ª StringBuilder å¯¹è±¡
  â””â”€â”€ ä¸€ä¸ª char[] value = {'a','b','c', ?, ?, ...}

æ ˆï¼š
sb â†’ è¿™ä¸ª StringBuilder
```

* å§‹ç»ˆæ˜¯**ä¸€ä¸ªå¯¹è±¡**ï¼Œå†…éƒ¨æ•°ç»„å†…å®¹ä¸æ–­ä¿®æ”¹

---

### ğŸ”¹ StringBuffer

åŸºæœ¬ä¸ StringBuilder åŒå›¾ï¼Œåªæ˜¯æ–¹æ³•åŠ é”ï¼š

```text
append(...) å¸¦ synchronized
â†’ å¤šçº¿ç¨‹å®‰å…¨
â†’ å•çº¿ç¨‹æ€§èƒ½ç•¥å·®
```

---

## 5ï¸âƒ£ å¥—å›ä½  AliOssUtil çš„ä»£ç 

```java
StringBuilder stringBuilder = new StringBuilder("https://");
stringBuilder
        .append(bucketName)
        .append(".")
        .append(endpoint)
        .append("/")
        .append(objectName);
```

å¯ä»¥ç”¨å†…å­˜å›¾ç†è§£ä¸ºï¼š

```text
ä¸€å¼€å§‹ï¼š "https://"

heap:  char[] = {'h','t','t','p','s',':','/','/', ?, ?, ...}

append(bucketName) ä¹‹åï¼š
heap:  char[] = {'h','t','t','p','s',':','/','/','m','y','-','b','u','c','k','e','t', ...}

åé¢ç»§ç»­ append ".", endpoint, "/", objectName
â†’ å…¨éƒ¨åœ¨åŒä¸€ä¸ª char[] é‡Œä¿®æ”¹
```

---

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥å¸®ä½ ï¼š

* ç”»ä¸€å¼  **â€œfor å¾ªç¯ä¸­ç”¨ String vs StringBuilderâ€** çš„å¯¹æ¯”å›¾ï¼ˆæ€§èƒ½å·®å¼‚ï¼‰
* å¸®ä½ å†™ä¸€æ®µ**é¢è¯•å›ç­”**ï¼šè§£é‡Š immutable + å†…å­˜å›¾ + æ€§èƒ½
* æˆ–è€…æŠŠè¿™æ®µ AliOssUtil å½“æˆé¢è¯•é¢˜ï¼Œå†™ä¸€æ®µâ€œæˆ‘æ˜¯æ€ä¹ˆä¼˜åŒ–å­—ç¬¦ä¸²æ‹¼æ¥çš„â€å›ç­”ç¨¿ ğŸ’¬
